# 'CAP 이론' 7월 5일 2025년

📖 작성자: [kimsee8200](https://github.com/kimsee8200)
## CAP 이론은 무엇입니까?

CAP 이론은 일관성 (Consistency), 가용성 (Availability), 분산 가능성 (Partition tolerance)을 적정 시간내에 모두를 만족하는 분산 시스템을 만들기 불가능 하다는 데이터베이스 시스템의 설계 이론이다.

이를 이해하려면 먼저 일관성과 가용성, 분산 가능성이 무엇인지 알아야한다.

## 용어정리
- 노드: 데이터베이스 인스턴스 (자원이 할당된 시스템)를 돌리는 물리적 서버 컴퓨터.
- **분산 데이터베이스 시스템 (중요)** : 데이터를 여러 대의 노드에 저장하는 시스템, 특정 노드에 저장되기 때문에 사용자는 어디에 데이터가 저장되어있는지 알지 못하고 탐색은 주변 노드를 통해서 이루어지기에 마치 하나의 DB를 사용하는 것처럼 활용되고 노드를 추가하여 수평적 확장이 가능해진다.
- NoSQL :  Not Only SQL의 약자. MongoDB 등이 대표적인 NoSQL이다. SQL문 뿐 아니라, DB에서 제공해주는 쿼리문으로 DB를 조작할 수 있다.

## 일관성 (Consistency)
우선 일관성은 데이터가 다른 노드에서도 동일하게 적용되어야 한다는 것이다. 예를 들어 B 노드에 저장한 노드를 A 노드에서 받아와도 B 노드의 데이터와 동일하게 반환되어야 한다는 것이다.

## 가용성 (Availability)
가용성은 언제든지 모든 요청을 받아 반환해야 하는 것이다. 실패해도 마찬가지다. 비유를 하자면 상담원이 없어도 ARS를 통하여 언제든지 데이터 가져올 수 있는 것처럼 데이터를 가져올 수 있다는 것이다.

## 분산 가능성 (Partition tolerance)
분산 가능성은 서로 다른 노드의 연결이 끊어지더라도 데이터를 관리할 수 있다는 이론이다. 예를 들어 한 노드가 다른 노드와 통신할 수 없을 때, 다른 복제 노드가 사용자 요청에 응답할 수 있어야 한다.

## 왜 이들을 동시에 모두 적용할 수 없을까?
눈치가 빠른 사람들은 금방 이해했을 것이다. 일관성과 분산가능성 (CP)을 보장하게 되면, 만약 통신이 끊어졌을 때 일관성을 지키기 위하여 복구 될 때 까지 기다려야한다. 이렇게 되면 언제든지 DB에 접근할 수 없게 되는 것이다.

 가용성과 분산가능성 (AP)을 시스템에 보장 하게 된다면, A 노드와 B 노드에 통신이 불가능 할 경우, 임시로 특정 노드에 데이터가 수정될 수도 있기에 일관을 보장할 수 없게 된다. 

분산 가능성은 분산 데이터베이스 시스템에서 필수적이기에 (장애발생 가능성이 높다) 이 두가지 조합은 분산 데이터베이스 시스템에서 사용하게 된다. 

나머지 일관성+가용성(CA)은 단일 시스템에서 주로 사용한다.

## 대표적인 분산 DB 시스템
1. MongoDB -> CP를 적용한 시스템이다 프라이머리 노드가 여러 서브 노드에 데이터 복제본을 저장한다. 그렇게 되면 프라이머리 노드가 중단되었을 경우 서브 노드 중에서 프라이머리 노드를 선출해야 한다. 그렇기에 CP가 되는 것이다.

2. Cassadra -> AP를 적용햇다 프라이머리 노드가 존제하지 않고 노드가 돌아가며 처리한다 시계방향으로 정해진 칸만큼 근처에 있는 노드들에 복제본을 넣는다. 그렇기에 모든 노드에 최신 데이터가 반영되기에는 시간이 걸리게 된다 그렇기에 일관성을 보장하기 어렵다.

## 결론
CAP 이론은 적합한 데이터베이스 시스템을 고르기 위한 이론이라 생각한다. 자신의 시스템에서 제일 적합한 DB를 찾는데 이러한 이론을 쓴다면 도움이 될 것 같다.

